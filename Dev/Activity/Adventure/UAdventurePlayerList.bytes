-- 奇遇玩家列表界面
local WindowBase = JRequire "Libs.WindowMgr.WindowBase"
local WindowType = JRequire "Libs.WindowMgr.WindowType"
local CCommon = JRequire "Dev.Common.CCommon"
local SoundMgr = JRequire "Libs.Sound.SoundMgr"
local TabGroup = JRequire "Dev.Common.TabGroup2"
local MStaff = JRequire "Dev.Staff.MStaff"
local MPlayer = JRequire "Dev.Player.MPlayer"

local _M = Class(WindowBase)
local _P = {}
local _R = {}

function _M:Dispatch(funcName, ...)
	local fun = _R[funcName]
	if fun ~= nil then 
		fun(self, ...)
	end
end

--有其他玩家参与
function _R.UpdateData(self,data)
	self.mData = data
	_P.SetDataList(self)
end

function _M:OnCreate(data,eventId)
	local module = self:CreateMoudle(self._RootNode, "M_Gang_member")
	self.mModule = module

	self.mData = data
	local closeBtn = module:Get("C_Back_Btn")
	closeBtn:AddOnButton(function ( ... )
		SoundMgr.Play(10002)
		self:Destroy()
	end, nil, 1.2)

	local eventCsv = Csv.AdventureSubEvent[eventId]
	self.content = module:Get("content")
	self.title = module:Get("C_Text")
	self.title.Text = Csv.Text("adventure_player_title")
	self.needTips = module:Get("WealthText")
	self.needNum = module:Get("WealthNum")
	self.needNum.Text = #self.mData.."/"..eventCsv.joinCount
	self.needTips.Text = Csv.Text("adventure_player_need")
	module:Get("C_Btn_e").Activity = false
	module:Get("Tips").Activity = false

	_P.SetDataList(self)
end

function _P.SetDataList(self)
	self.content:DestroyChildren()
	local itemTab = {}
	for k,v in pairs(self.mData) do
		local item = _P.AddItemToContent(self,self.content,v)
		itemTab[k] = item
	end

	self.mItemTab = itemTab
end

function _P.AddItemToContent(self,content,data)
	local moudle = JGuiManager.GetMoudle(content,"M_Gang_member_Item", WindowType.UI, 10)

	local csvVip = Csv.Vip[data.vip]
	if csvVip ~= nil and csvVip.imgBord ~= nil then
		moudle:Get("OutBox").SpriteName = csvVip.imgBord
		moudle:Get("Num").SpriteNameAutoScale = "friend_num_"..data.vip
	else
		moudle:Get("OutBox").Activity = false
	end
	moudle:Get("C_Btn_b").Activity = false
	moudle:Get("Head").SpriteName = MPlayer.GetOtherHeadIcon(data.icon,data.sex)
	moudle:Get("position").Text = Csv.Text("adventure_player_level"..data.job)
	moudle:Get("SLNum").Text = data.power
	moudle:Get("ShName").Text = data.name
	moudle:Get("SLText").Text = Csv.Text("adventure_power")
	moudle:Get("NameText").Text = data.devote
	moudle:Get("Company").Text = Csv.Text("adventure_devote")
	moudle:Get("contribution").Text = Csv.Text("adventure_level")
	moudle:Get("contributionText").Text = data.level
	moudle:Get("PeopleNum").Text = Csv.Personnel[data.staffId].name
	moudle:Get("Time").Text = Csv.Text("adventure_send_staff")  
	return moudle
end

return _M