local JGuiManager = CS.JGui.JGuiManager
local WindowType = JRequire "Libs.WindowMgr.WindowType"
local MStaff = JRequire "Dev.Staff.MStaff"
local MBag = JRequire "Dev.Bag.MBag"
local SoundMgr = JRequire "Libs.Sound.SoundMgr"
local CStaff = JRequire "Dev.Staff.CStaff"
local CCommon = JRequire "Dev.Common.CCommon"

local _M = Class()
local _P = {}

--界面构建
function _M:ctor(parent,id)
	self._RootNode = parent
	local moudle = JGuiManager.GetMoudle(self._RootNode, "M_Staff_NotOverview", WindowType.UI, 0)
	self.mMoudle = moudle
	self.mStaffid = id
	local person = Csv.Personnel[id]

	moudle:Get("Property").Text = Csv.Text("staff_property")
	moudle:Get("Level_0").Text = Csv.Text("staff_attriT1")
	moudle:Get("LevelData_0").Text = person.age
	moudle:Get("Speciality_0").Text = Csv.Text("staff_attriT2")
	moudle:Get("SpecialityData_0").Text = person.zhiwei
	moudle:Get("Property_0").Text = Csv.Text("staff_attriT3")
	moudle:Get("PropertyData_0").Text = person.tedian
	moudle:Get("Attri1_0").Text = Csv.Text("staff_attriT4")
	moudle:Get("Attri1Data_0").Text = person.koutou
	moudle:Get("Attri2_0").Text = Csv.Text("staff_attriT5")
	moudle:Get("Attri2Data_0").Text = person.tips

	self:OnCreateData(id)
end

function _M:OnCreateData(id)
	local moudle = self.mMoudle
	local def = Csv.Personnel[id]
	local csvColorUp = Csv.ColorUp[def.color]
	moudle:Get("LevelData").Text = Csv.Text("company_exp",{num = def.level,max = csvColorUp.lvMax})
	local attr1, attr2, attr3, attr4 = MStaff.GetStaffAttrLvlOne(id)
	moudle:Get("PropertyData").Text = math.ceil(attr1 + attr2 + attr3 + attr4)
	moudle:Get("Attri1Data").Text = math.ceil(attr1)
	moudle:Get("Attri2Data").Text = math.ceil(attr2)
	moudle:Get("Attri3Data").Text = math.ceil(attr3)
	moudle:Get("Attri4Data").Text = math.ceil(attr4)

	moudle:Get("C_text").Text = Csv.Text("staff_get")
	local BtnUp = moudle:Get("C_Btn_a")
	BtnUp:AddOnButton(function ( ... )
		SoundMgr.Play(10001)
		WindowMgr.Create("UStaffTrack", id)
		end, nil, 0.9)
end

function _M:Destroy()
	local moudle = self.mMoudle
	if moudle ~= nil then
		moudle:Destroy()
	end
end

return _M
